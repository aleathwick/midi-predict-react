(this["webpackJsonpmidi-predict-react"]=this["webpackJsonpmidi-predict-react"]||[]).push([[0],{344:function(e,t,n){},359:function(e,t){},360:function(e,t){},368:function(e,t){},378:function(e,t){},379:function(e,t){},380:function(e,t){},388:function(e,t){},395:function(e,t,n){"use strict";n.r(t);var i=n(11),c=n.n(i),o=n(62),r=n.n(o),a=(n(344),n(6)),s=n(426),l=n(436),d=n(437),u=n(307),b=n.n(u),f=n(309),j=n.n(f),m=n(228),h=n.n(m),p=n(308),O=n.n(p),v=n(429),g=n(312),x=n(281),y=["mid","midi"],R=n(438);function N(e,t,n){return Math.min(Math.max((e-t/127)/(n/127-t/127),1/127),1)}var k=n(80),S=n(234),F=n.n(S),C=n(31);function w(e){function t(t){var n=60/t.header.tempos[0].bpm/4;!function(e,t){e.forEach((function(e){e.subbeat=Math.round(e.time/t)})),e.sort((function(e,t){return e.time-t.time}))}(t.tracks[0].notes,n),e.setMidiFile(t),e.setNotes(t.tracks[0].notes),e.setFilteredNotes(t.tracks[0].notes.filter((function(t){return t.subbeat<4*e.bars*4}))),console.log(t.tracks[0].notes)}var n=Object(i.useState)(!1),c=Object(a.a)(n,2),o=c[0],r=c[1],u=Object(i.useState)(!1),f=Object(a.a)(u,2),m=f[0],p=f[1],S=Object(i.useState)(0),w=Object(a.a)(S,2),I=w[0],_=w[1];o&function(e){var t=Object(i.useRef)();return Object(i.useEffect)((function(){t.current=e})),t.current}(e.bars)!==e.bars&&r(!1);var P=Object(i.useRef)();var M=new FileReader;return M.addEventListener("load",(function(){r(!1);var e=new x.Midi(M.result);e.tracks.length>1&&alert("midi file has more than one track, first will be used"),t(e)}),!1),Object(C.jsxs)(s.a,{id:"controls-container",children:[Object(C.jsx)(g.a,{variant:"h4",children:"Controls"}),Object(C.jsx)("input",{ref:P,id:"hidden-input",type:"file",onChange:function(e){if("undefined"===typeof e||0===e.target.files.length)return null;var t=e.target.files[0];console.log(t),y.indexOf(t.name.split(".").pop())>=0?(console.log("Selected file: ".concat(t.name)),M.readAsArrayBuffer(t)):alert("The file extension ".concat(t.name.split(".").pop()," is invalid, must be in ").concat(y))}}),Object(C.jsx)(l.a,{variant:"contained",color:"primary",endIcon:Object(C.jsx)(b.a,{}),className:"control-button",onClick:function(){P.current.click()},children:"Load File"}),Object(C.jsxs)(l.a,{variant:"contained",color:"secondary",disabled:null===e.encoderRef.current||null===e.decoderRef.current||null===e.midiFile,endIcon:Object(C.jsx)(O.a,{}),className:"control-button",onClick:function(){p(!0);var t=function(e){var t=[1,e.length,1];return{TBn_in:k.c(k.b(e.map((function(e){return Math.floor(e.subbeat%16/4)})),4),[1,e.length,4]),TSBn_in:k.c(k.b(e.map((function(e){return e.subbeat%4})),4),[1,e.length,4]),PSn_in:k.d(e.map((function(e){return(e.midi-22)/88})),t),PCn_in:k.c(k.b(e.map((function(e){return(e.midi-22)%12})),12),[1,e.length,12])}}(e.filteredNotes);console.log(e.encoderRef.current.summary());for(var n=e.encoderRef.current.inputs.map((function(e){return t[e.originalName]})),i=e.encoderRef.current.predict(n,{batchSize:1}),c=k.e([1,1,1]),o=[],a=function(t){_(t/i.shape[1]*100);var n={encoded:i.slice([0,t,0],[1,1,i.shape.slice(-1)[0]]),Vn_ar:c};console.log(e.decoderRef);var r=e.decoderRef.current.inputs.map((function(e){return n[e.originalName]}));c=e.decoderRef.current.predict(r,{batchSize:1}),o.push(c.flatten().array())},s=0;s<i.shape[1];s++)a(s);var l=F()(e.notes);Promise.all(o).then((function(t){console.log(t),t.forEach((function(e,t){l[t].velocity=e[0]})),e.setNotes(l);var n=l.filter((function(t){return t.subbeat<4*e.bars*4}));e.setFilteredNotes(n),e.midiFile.tracks[0].notes=l,r(!0),p(!1)}))},children:["Predict ",m&&Object(C.jsx)(v.a,{className:"predict-progress",size:24,variant:"determinate",value:I})]}),Object(C.jsx)(l.a,{variant:"contained",color:"secondary",endIcon:Object(C.jsx)(j.a,{}),className:"control-button",disabled:!o,onClick:function(){var t=F()(e.filteredNotes);t.forEach((function(t){return t.velocity=N(t.velocity,e.velocityRange[0],e.velocityRange[1])}));var n=Object.create(e.midiFile);n.tracks[0].notes=t;var i=new Blob([n.toArray()],{type:"octet/stream"}),c=window.document.createElement("a");c.href=window.URL.createObjectURL(i),c.download="prediction.mid",c.click()},children:"Download Prediction"}),Object(C.jsxs)(g.a,{className:"slider-description",variant:"button",children:[Object(C.jsx)(d.a,{title:"Select the number of bars to use",children:Object(C.jsx)(h.a,{fontSize:"small",className:"info-icon"})}),Object(C.jsx)("span",{children:"Bars"})]}),Object(C.jsx)(R.a,{defaultValue:8,getAriaValueText:function(e){return"".concat(e," bars")},min:1,max:12,marks:[{value:4,label:"4 bars"},{value:8,label:"8 bars"}],valueLabelDisplay:null===e.midiFile?"off":"auto",onChange:function(t,n){e.setBars(n),e.setFilteredNotes(e.midiFile.tracks[0].notes.filter((function(e){return e.subbeat<4*n*4})))},disabled:null===e.midiFile}),Object(C.jsxs)(g.a,{className:"slider-description",variant:"button",children:[Object(C.jsx)(d.a,{title:"Select the minimum and maximum MIDI velocity values",children:Object(C.jsx)(h.a,{fontSize:"small",className:"info-icon"})}),Object(C.jsx)("span",{children:"Velocity Scaling"})]}),Object(C.jsx)(R.a,{min:0,max:127,marks:[{value:0,label:"0"},{value:127,label:"127"}],value:e.velocityRange,valueLabelDisplay:"auto",onChange:function(t,n){e.setVelocityRange(n)},disabled:null===e.midiFile}),Object(C.jsx)(l.a,{variant:"contained",color:"primary",endIcon:Object(C.jsx)(h.a,{}),className:"control-button bottom-button",onClick:function(){return e.setInfoOpen(!0)},children:"Info"})]})}function I(e){function t(t){var n=N(t,e.velocityRange[0],e.velocityRange[1]);return"hsl(".concat(150*n,", 100%, 50%)")}for(var n=[],i=1;i<e.bars;i++)n.push(Object(C.jsx)("div",{style:{borderRight:"solid",borderColor:"rgba(1, 1, 1, 0.1)",borderWidth:"1px",gridColumn:4*i*4,gridRow:"1 / -1"}}));var c=e.filteredNotes?e.filteredNotes.map((function(n){return Object(C.jsx)(d.a,{enterDelay:0,title:Object(C.jsxs)("div",{style:{whiteSpace:"pre"},children:["Velocity: ",Math.round(127*n.velocity),Object(C.jsx)("br",{}),"Scaled Velocity: ",Math.round(127*N(n.velocity,e.velocityRange[0],e.velocityRange[1])),Object(C.jsx)("br",{}),"Pitch class: ",(n.midi-4)%12]}),children:Object(C.jsx)("div",{className:"note-box",style:{gridColumn:n.subbeat+1,gridRow:88-(n.midi-22+1),backgroundColor:t(n.velocity)}})})})):[];return Object(C.jsxs)(s.a,{id:"notes-container",style:{gridTemplateColumns:"repeat(".concat(4*e.bars*4,", 1fr)")},children:[n,c]})}var _=n(435),P=n(434),M=n(432),B=n(433),E=n(431);function L(e){var t=function(){e.setInfoOpen(!1),console.log("closed")},n=c.a.useRef(null);return c.a.useEffect((function(){if(e.infoOpen){var t=n.current;null!==t&&t.focus()}}),[e.infoOpen]),Object(C.jsxs)(_.a,{open:e.infoOpen,onClose:t,scroll:"body","aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",children:[Object(C.jsx)(E.a,{id:"scroll-dialog-title",children:"Info"}),Object(C.jsx)(M.a,{dividers:"body",children:Object(C.jsxs)(B.a,{id:"scroll-dialog-description",ref:n,tabIndex:-1,children:[Object(C.jsx)("p",{children:"This website provides a simple interface to deep learning models designed to predict velocities of notes in piano sequences."}),Object(C.jsxs)("p",{children:["For MIDI files to work properly with this website, they should:",Object(C.jsxs)("ul",{children:[Object(C.jsx)("li",{children:"Be in 4/4 time signature"}),Object(C.jsx)("li",{children:"Have a tempo that accurately reflects the tempo of the music"}),Object(C.jsx)("li",{children:"Have notes that fall closest in time to the timestamp of the actual nearest semi-quaver/16th as determined by the tempo (so that notes can be quantized accurately)"}),Object(C.jsx)("li",{children:"Contain all notes for prediction in the first midi track"})]})]}),Object(C.jsxs)("p",{children:["For more info, see:",Object(C.jsxs)("ul",{children:[Object(C.jsxs)("li",{children:[Object(C.jsx)("a",{href:"https://soundcloud.com/user-611170338/sets/deep-learning-and-music-humanizing-piano-scores-longer-examples",children:"Audio examples"})," of model outputs"]}),Object(C.jsxs)("li",{children:[Object(C.jsx)("a",{href:"https://github.com/aleathwick/781-piano-autoencoder",children:"Github repo"}),", including datasets and code for parsing data and training models"]})]})]})]})}),Object(C.jsx)(P.a,{children:Object(C.jsx)(l.a,{onClick:t,color:"primary",children:"Close"})})]})}var T=function(e){var t=Object(i.useState)(null),n=Object(a.a)(t,2),o=n[0],r=n[1],s=Object(i.useState)(null),l=Object(a.a)(s,2),d=l[0],u=l[1],b=Object(i.useState)(null),f=Object(a.a)(b,2),j=f[0],m=f[1],h=Object(i.useState)(8),p=Object(a.a)(h,2),O=p[0],v=p[1],g=c.a.useState([0,127]),x=Object(a.a)(g,2),y=x[0],R=x[1],N=c.a.useState(!1),k=Object(a.a)(N,2),S=k[0],F=k[1],_=Object(i.useRef)(null),P=Object(i.useRef)(null);return Promise.all([e.encoderPromise,e.decoderPromise]).then((function(e){_.current=e[0],P.current=e[1]})).catch((function(e){console.log("model failed to load"),console.log(e.message)})),Object(C.jsxs)("div",{id:"app-container",children:[Object(C.jsx)(w,{midiFile:o,setMidiFile:r,notes:d,setNotes:u,filteredNotes:j,setFilteredNotes:m,velocityRange:y,setVelocityRange:R,setInfoOpen:F,bars:O,setBars:v,encoderRef:_,decoderRef:P}),Object(C.jsx)(I,{filteredNotes:j,bars:O,velocityRange:y}),Object(C.jsx)(L,{infoOpen:S,setInfoOpen:F})]})},V=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,440)).then((function(t){var n=t.getCLS,i=t.getFID,c=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),i(e),c(e),o(e),r(e)}))},z=k.a("/midi-predict-react/models/532_tfjs_best_val_encoder_no_seq/model.json"),D=k.a("/midi-predict-react/models/532_tfjs_best_val_decoder_no_seq/model.json");Promise.all([z,D]).then((function(e){console.log(e),console.log("models loaded successfully")})),r.a.render(Object(C.jsx)(c.a.StrictMode,{children:Object(C.jsx)(T,{encoderPromise:z,decoderPromise:D})}),document.getElementById("root")),V()}},[[395,1,2]]]);
//# sourceMappingURL=main.46650822.chunk.js.map